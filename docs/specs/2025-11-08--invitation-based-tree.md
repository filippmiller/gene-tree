# Invitation-Based Family Tree MVP

–î–∞—Ç–∞: 2025-11-08
–ê–≤—Ç–æ—Ä: Warp AI Agent
–°—Ç–∞—Ç—É—Å: Active
–ó–∞–º–µ–Ω—è–µ—Ç: 2025-11-08--family-tree-mvp.md

## –ö–ª—é—á–µ–≤–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è

**–†–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ —Å–µ–º–µ–π–Ω–æ–µ –¥–µ—Ä–µ–≤–æ —á–µ—Ä–µ–∑ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è:**
- –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = –æ–¥–∏–Ω —Ä–µ–∞–ª—å–Ω—ã–π —á–µ–ª–æ–≤–µ–∫ (user = person)
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ª–∏–±–æ –Ω–∞–ø—Ä—è–º—É—é, –ª–∏–±–æ –ø–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é
- –†–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏ –ø—Ä–∏–≥–ª–∞—à–∞—é—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–≤–∞—è —Å–≤—è–∑–∏
- –ö–∞–∂–¥—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å
- –î–µ—Ä–µ–≤–æ —Ä–∞—Å—Ç—ë—Ç –æ—Ä–≥–∞–Ω–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ —Å–µ—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π

## –¶–µ–ª–∏ MVP

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ø—Ä–æ—Ñ–∏–ª—å**
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –æ —Å–µ–±–µ
   - –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Å –ø–æ–ª—è–º–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ

2. **–°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π**
   - –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è (email/phone + —Ç–∏–ø —Ä–æ–¥—Å—Ç–≤–∞)
   - –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –ø–æ email
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ-–ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

3. **–ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ä–µ–≤–∞**
   - –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ–º–µ–π–Ω–æ–≥–æ –¥–µ—Ä–µ–≤–∞
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö (–ø—É–±–ª–∏—á–Ω—ã–µ/—Å–µ–º–µ–π–Ω—ã–µ)

4. **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑—è–º–∏**
   - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å–≤—è–∑–µ–π
   - –£–¥–∞–ª–µ–Ω–∏–µ —Å–≤—è–∑–∏ (–ø–æ —Å–æ–≥–ª–∞—Å–∏—é –æ–±–µ–∏—Ö —Å—Ç–æ—Ä–æ–Ω?)

## –ù–µ-—Ü–µ–ª–∏ (out of scope –¥–ª—è MVP)

- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ–º–µ–π–Ω—ã–µ –≥—Ä—É–ø–ø—ã
- –ú–æ–¥–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
- –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (–¥–≤–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –æ–¥–Ω–æ–º—É —á–µ–ª–æ–≤–µ–∫—É)
- –°–ª–æ–∂–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ (—Ç–æ–ª—å–∫–æ: public, family, private)
- –°–æ–±—ã—Ç–∏—è –∏ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- GEDCOM –∏–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç

## –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞: `user_profiles` (—Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ auth.users)

```sql
CREATE TABLE user_profiles (
  id UUID PRIMARY KEY REFERENCES auth.users(id) ON DELETE CASCADE,
  
  -- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  first_name TEXT NOT NULL,
  middle_name TEXT,
  last_name TEXT NOT NULL,
  maiden_name TEXT,
  nickname TEXT,
  
  -- –î–∞—Ç—ã
  birth_date DATE,
  birth_place TEXT,
  death_date DATE,
  death_place TEXT,
  is_living BOOLEAN DEFAULT true,
  
  -- –ü–æ–ª
  gender TEXT CHECK (gender IN ('male', 'female', 'other', 'unknown')),
  
  -- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
  bio TEXT,
  avatar_url TEXT,
  occupation TEXT,
  phone TEXT,
  
  -- –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å (JSON –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏)
  privacy_settings JSONB DEFAULT '{"birth_date": "family", "birth_place": "family", "phone": "private", "bio": "public"}'::jsonb,
  
  -- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_user_profiles_last_name ON user_profiles(last_name);
CREATE INDEX idx_user_profiles_birth_date ON user_profiles(birth_date);

-- –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
CREATE OR REPLACE FUNCTION create_user_profile()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO user_profiles (id, first_name, last_name)
  VALUES (
    NEW.id,
    COALESCE(NEW.raw_user_meta_data->>'name', 'User'),
    COALESCE(NEW.raw_user_meta_data->>'last_name', '')
  );
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

CREATE TRIGGER on_auth_user_created
  AFTER INSERT ON auth.users
  FOR EACH ROW EXECUTE FUNCTION create_user_profile();
```

### –¢–∞–±–ª–∏—Ü–∞: `invitations`

```sql
CREATE TABLE invitations (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  
  -- –ö—Ç–æ –ø—Ä–∏–≥–ª–∞—à–∞–µ—Ç
  inviter_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  
  -- –ö–æ–≥–æ –ø—Ä–∏–≥–ª–∞—à–∞—é—Ç
  invitee_email TEXT NOT NULL,
  invitee_phone TEXT,
  
  -- –¢–∏–ø —Ä–æ–¥—Å—Ç–≤–∞ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ inviter)
  relationship_type TEXT NOT NULL CHECK (
    relationship_type IN (
      'parent',    -- —Ä–æ–¥–∏—Ç–µ–ª—å
      'child',     -- —Ä–µ–±—ë–Ω–æ–∫
      'spouse',    -- —Å—É–ø—Ä—É–≥(–∞)
      'sibling',   -- –±—Ä–∞—Ç/—Å–µ—Å—Ç—Ä–∞
      'grandparent',
      'grandchild',
      'uncle_aunt',
      'nephew_niece',
      'cousin'
    )
  ),
  
  -- –¢–æ–∫–µ–Ω –∏ —Å—Ç–∞—Ç—É—Å
  token TEXT UNIQUE NOT NULL DEFAULT encode(gen_random_bytes(32), 'hex'),
  status TEXT DEFAULT 'pending' CHECK (status IN ('pending', 'accepted', 'expired', 'rejected')),
  
  -- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  message TEXT,
  
  -- –ö—Ç–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è –ø–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ accept)
  accepted_user_id UUID REFERENCES auth.users(id) ON DELETE SET NULL,
  
  -- –î–∞—Ç—ã
  created_at TIMESTAMPTZ DEFAULT NOW(),
  expires_at TIMESTAMPTZ DEFAULT NOW() + INTERVAL '30 days',
  accepted_at TIMESTAMPTZ
);

CREATE INDEX idx_invitations_inviter ON invitations(inviter_id);
CREATE INDEX idx_invitations_token ON invitations(token);
CREATE INDEX idx_invitations_email ON invitations(invitee_email);
CREATE INDEX idx_invitations_status ON invitations(status);
```

### –¢–∞–±–ª–∏—Ü–∞: `relationships`

```sql
CREATE TABLE relationships (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  
  user1_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  user2_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
  
  -- –¢–∏–ø —Å–≤—è–∑–∏ (—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–µ: spouse, sibling; –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ: parent)
  relationship_type TEXT NOT NULL CHECK (
    relationship_type IN (
      'parent',    -- user1 —è–≤–ª—è–µ—Ç—Å—è —Ä–æ–¥–∏—Ç–µ–ª–µ–º user2
      'spouse',
      'sibling',
      'grandparent',
      'uncle_aunt',
      'cousin'
    )
  ),
  
  -- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  marriage_date DATE,
  marriage_place TEXT,
  divorce_date DATE,
  
  -- –°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–∑–¥–∞–ª–æ —ç—Ç—É —Å–≤—è–∑—å
  created_from_invitation_id UUID REFERENCES invitations(id) ON DELETE SET NULL,
  
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  -- –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
  CONSTRAINT unique_relationship UNIQUE (user1_id, user2_id, relationship_type),
  CONSTRAINT different_users CHECK (user1_id != user2_id)
);

CREATE INDEX idx_relationships_user1 ON relationships(user1_id);
CREATE INDEX idx_relationships_user2 ON relationships(user2_id);
CREATE INDEX idx_relationships_type ON relationships(relationship_type);
```

### Privacy Settings Schema

```typescript
interface PrivacySettings {
  birth_date: 'public' | 'family' | 'private';
  birth_place: 'public' | 'family' | 'private';
  death_date: 'public' | 'family' | 'private';
  death_place: 'public' | 'family' | 'private';
  phone: 'public' | 'family' | 'private';
  occupation: 'public' | 'family' | 'private';
  bio: 'public' | 'family' | 'private';
  avatar_url: 'public' | 'family' | 'private';
}

// Defaults:
// - public: bio, occupation, avatar
// - family: –¥–∞—Ç—ã, –º–µ—Å—Ç–∞, maiden_name
// - private: phone
```

## API Endpoints

### Profile API

#### GET /api/profile/me
–ü–æ–ª—É—á–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å (–ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –ø–æ–ª—è–º)

#### PUT /api/profile/me
–û–±–Ω–æ–≤–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å

#### GET /api/profile/:userId
–ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞ (—Å —É—á—ë—Ç–æ–º privacy settings)

### Invitations API

#### POST /api/invitations
–°–æ–∑–¥–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
```typescript
Request: {
  invitee_email: string,
  invitee_phone?: string,
  relationship_type: string,
  message?: string
}
Response: { data: Invitation }
```

#### GET /api/invitations/sent
–°–ø–∏—Å–æ–∫ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π

#### GET /api/invitations/received
–°–ø–∏—Å–æ–∫ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π (–ø–æ email)

#### GET /api/invitations/:token
–ü–æ–ª—É—á–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –ø–æ —Ç–æ–∫–µ–Ω—É (–¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)

#### POST /api/invitations/:token/accept
–ü—Ä–∏–Ω—è—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ (—Å–æ–∑–¥–∞—ë—Ç relationship)

#### POST /api/invitations/:token/reject
–û—Ç–∫–ª–æ–Ω–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ

### Relationships API

#### GET /api/relationships/me
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Å–≤—è–∑–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```typescript
Response: {
  parents: User[],
  children: User[],
  spouses: User[],
  siblings: User[],
  // ... –¥—Ä—É–≥–∏–µ
}
```

#### GET /api/relationships/tree
–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω–æ–µ –¥–µ—Ä–µ–≤–æ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤

#### DELETE /api/relationships/:id
–£–¥–∞–ª–∏—Ç—å —Å–≤—è–∑—å

### Family API

#### GET /api/family
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤ (—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ privacy)

## UI Flows

### 1. –ü–µ—Ä–≤–∏—á–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–æ—Å–Ω–æ–≤–∞—Ç–µ–ª—å –¥–µ—Ä–µ–≤–∞)

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ `/sign-up`
2. –ó–∞–ø–æ–ª–Ω—è–µ—Ç email, –ø–∞—Ä–æ–ª—å, –∏–º—è
3. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç email
4. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ `/profile/complete` - –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
5. –ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è ‚Üí `/app` (dashboard)

### 2. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç email —Å —Å—Å—ã–ª–∫–æ–π: `https://app.com/invite/{token}`
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å—Å—ã–ª–∫—É ‚Üí –≤–∏–¥–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –∫—Ç–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª
3. –ù–∞–∂–∏–º–∞–µ—Ç "Accept & Sign Up"
4. –ó–∞–ø–æ–ª–Ω—è–µ—Ç email, –ø–∞—Ä–æ–ª—å, –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
5. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è:**
   - –ê–∫–∫–∞—É–Ω—Ç
   - –ü—Ä–æ—Ñ–∏–ª—å
   - Relationship —Å inviter
6. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ `/profile/complete`
7. –ó–∞—Ç–µ–º ‚Üí `/app`

### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è

1. Dashboard ‚Üí –∫–Ω–æ–ø–∫–∞ "Invite Family Member"
2. –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ñ–æ—Ä–º–æ–π:
   - Email –∞–¥—Ä–µ—Å
   - –¢–∏–ø —Ä–æ–¥—Å—Ç–≤–∞ (dropdown: Father, Mother, Son, Daughter, Spouse, Sibling...)
   - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
3. Submit ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ email
4. –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ "Sent Invitations" —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º

### 4. –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞

1. Dashboard ‚Üí "Family Members" ‚Üí –∫–ª–∏–∫ –Ω–∞ —á–µ–ª–æ–≤–µ–∫–∞
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–æ—Ñ–∏–ª—å —Å —É—á—ë—Ç–æ–º privacy:
   - Public –ø–æ–ª—è - –≤–∏–¥–Ω—ã –≤—Å–µ–≥–¥–∞
   - Family –ø–æ–ª—è - –≤–∏–¥–Ω—ã —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∞–º
   - Private –ø–æ–ª—è - —Å–∫—Ä—ã—Ç—ã
3. –ö–Ω–æ–ø–∫–∏: "View Relationship", "Message" (future)

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

1. Dashboard ‚Üí "My Profile" ‚Üí "Privacy Settings"
2. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —É—Ä–æ–≤–µ–Ω—å:
   - üåç Public (–≤—Å–µ)
   - üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family (—Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏)
   - üîí Private (—Ç–æ–ª—å–∫–æ —è)

## Email Template: Invitation

```
Subject: You've been invited to join the Family Tree by {InviterName}

Hi!

{InviterName} has invited you to join the family tree on FamilyTree.com

Relationship: {InviterName} is your {relationship}

{PersonalMessage}

Click here to accept and create your profile:
[Accept Invitation Button] ‚Üí https://app.com/invite/{token}

This invitation expires in 30 days.

---
If you don't want to join, simply ignore this email.
```

## RLS Policies

```sql
-- User Profiles: –∫–∞–∂–¥—ã–π –≤–∏–¥–∏—Ç —Å–≤–æ–π + —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω–∏–∫–æ–≤ (—Å —É—á—ë—Ç–æ–º privacy)
CREATE POLICY "Users can view their own profile"
  ON user_profiles FOR SELECT
  USING (auth.uid() = id);

CREATE POLICY "Users can view family profiles"
  ON user_profiles FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM relationships r
      WHERE (r.user1_id = auth.uid() AND r.user2_id = user_profiles.id)
         OR (r.user2_id = auth.uid() AND r.user1_id = user_profiles.id)
    )
  );

CREATE POLICY "Users can update their own profile"
  ON user_profiles FOR UPDATE
  USING (auth.uid() = id)
  WITH CHECK (auth.uid() = id);

-- Invitations
CREATE POLICY "Users can view their sent invitations"
  ON invitations FOR SELECT
  USING (auth.uid() = inviter_id);

CREATE POLICY "Users can view invitations to their email"
  ON invitations FOR SELECT
  USING (
    auth.jwt()->>'email' = invitee_email
    OR auth.uid() = accepted_user_id
  );

CREATE POLICY "Users can create invitations"
  ON invitations FOR INSERT
  WITH CHECK (auth.uid() = inviter_id);

-- Relationships: –≤—Å–µ –º–æ–≥—É—Ç –≤–∏–¥–µ—Ç—å —Å–≤–æ–∏ —Å–≤—è–∑–∏
CREATE POLICY "Users can view their relationships"
  ON relationships FOR SELECT
  USING (
    auth.uid() = user1_id OR auth.uid() = user2_id
  );
```

## Privacy Filter Logic (Backend)

```typescript
function filterProfileByPrivacy(
  profile: UserProfile,
  viewerId: string,
  isFamily: boolean
): Partial<UserProfile> {
  const filtered = { ...profile };
  const settings = profile.privacy_settings;
  
  for (const [field, level] of Object.entries(settings)) {
    if (level === 'private' && viewerId !== profile.id) {
      delete filtered[field];
    }
    if (level === 'family' && !isFamily && viewerId !== profile.id) {
      delete filtered[field];
    }
    // 'public' - –¥–æ—Å—Ç—É–ø–Ω–æ –≤—Å–µ–º
  }
  
  return filtered;
}
```

## –¢–µ—Å—Ç-–∫–µ–π—Å—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –∏ –∑–∞–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å
2. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª—é
3. ‚úÖ –†–æ–¥–∏—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç email, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ —Å—Å—ã–ª–∫–µ
4. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å–≤—è–∑—å parent-child
5. ‚úÖ –û–±–∞ –≤–∏–¥—è—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –≤ "Family Members"
6. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å —Å–≤–æ–∏—Ö –ø–æ–ª–µ–π
7. ‚úÖ –†–æ–¥–∏—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –ø–æ–ª—è
8. ‚úÖ –î–µ—Ä–µ–≤–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### Edge cases
- –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –Ω–∞ —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π email
- Expired invitation
- –î–≤–∞ —á–µ–ª–æ–≤–µ–∫–∞ –ø—Ä–∏–≥–ª–∞—à–∞—é—Ç –æ–¥–Ω–æ–≥–æ (–∫–æ–Ω—Ñ–ª–∏–∫—Ç)
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—ã—Ç–∞–µ—Ç—Å—è –∏–∑–º–µ–Ω–∏—Ç—å —á—É–∂–æ–π –ø—Ä–æ—Ñ–∏–ª—å
- –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ —Å–≤—è–∑–∏
- –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ —Å–≤—è–∑—è–º–∏

## –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

1. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π**
   - –†–∏—Å–∫: –î–≤–∞ —á–µ–ª–æ–≤–µ–∫–∞ –ø—Ä–∏–≥–ª–∞—à–∞—é—Ç –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: –í MVP - first come first served. –í v2 - conflict resolution UI

2. **–°–ø–∞–º –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π**
   - –†–∏—Å–∫: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: Rate limiting (max 10 –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π –≤ –¥–µ–Ω—å)

3. **Privacy leaks**
   - –†–∏—Å–∫: –ë–∞–≥ –≤ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: –°—Ç—Ä–æ–≥–∏–µ RLS policies + backend validation

4. **Orphaned profiles**
   - –†–∏—Å–∫: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–ª –∞–∫–∫–∞—É–Ω—Ç –Ω–æ –Ω–µ –∑–∞–ø–æ–ª–Ω–∏–ª –ø—Ä–æ—Ñ–∏–ª—å
   - –ú–∏—Ç–∏–≥–∞—Ü–∏—è: Reminder emails, incomplete profile indicator

## –°–ª–µ–¥—É—é—â–∏–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏ (–ø–æ—Å–ª–µ MVP)

- Conflict resolution –¥–ª—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π
- –ì—Ä—É–ø–ø–æ–≤—ã–µ —Å–µ–º–µ–π–Ω—ã–µ —á–∞—Ç—ã
- –°–æ–±—ã—Ç–∏—è –∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—å
- –î–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Ñ–æ—Ç–æ–∞–ª—å–±–æ–º—ã
- –ì–µ–Ω–µ–∞–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –æ—Ç—á—ë—Ç—ã
- GEDCOM —ç–∫—Å–ø–æ—Ä—Ç
- Mobile app
