# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–∏—Å—Ç–µ–º—ã –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. UI –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- ‚úÖ –£–±—Ä–∞–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞ (–±—ã–ª –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö)
- ‚úÖ Dashboard —Ç–µ–ø–µ—Ä—å full-width (–±–µ–∑ max-w-7xl)
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ—Ñ–∏–ª—å" –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏—é

### 2. –°–∏—Å—Ç–µ–º–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞ `preferred_locale` –≤ `user_profiles`
- ‚úÖ API endpoints –¥–ª—è —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ —è–∑—ã–∫–∞ `/api/user/locale`
- ‚úÖ LanguageSwitcher —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—ã–±–æ—Ä –≤ –ë–î
- ‚úÖ –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –±—Ä–∞—É–∑–µ—Ä–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —è–∑—ã–∫–∞

### 3. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ `docs/LOCALIZATION.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ Playwright —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

---

## üöÄ –®–∞–≥–∏ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏

### –®–∞–≥ 1: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î

**–í–∞—Ä–∏–∞–Ω—Ç –ê (—á–µ—Ä–µ–∑ Supabase Dashboard):**

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://supabase.com/dashboard/project/mbntpsfllwhlnzuzspvp/sql
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `apply-locale-migration.sql`
3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor
4. –ù–∞–∂–º–∏—Ç–µ "Run"

**–í–∞—Ä–∏–∞–Ω—Ç –ë (—á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É - –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω Supabase CLI):**

```bash
supabase db execute < apply-locale-migration.sql
```

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏—Ö —è–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:

```sql
-- –î–ª—è –§–∏–ª–∏–ø–ø–∞ (filippmiller@gmail.com) —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
UPDATE public.user_profiles
SET preferred_locale = 'en'
WHERE id = (SELECT id FROM auth.users WHERE email = 'filippmiller@gmail.com');

-- –î–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö - —Ä—É—Å—Å–∫–∏–π (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
UPDATE public.user_profiles
SET preferred_locale = 'ru'
WHERE preferred_locale IS NULL;
```

### –®–∞–≥ 3: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å dev server

```bash
npm run dev
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Ä—É—á–Ω—É—é

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000
2. –ó–∞–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ:
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –û–î–ù–ê –∫–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞ (—Å–ø—Ä–∞–≤–∞ –≤–≤–µ—Ä—Ö—É)
   - Dashboard –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é —à–∏—Ä–∏–Ω—É
   - –ï—Å—Ç—å –∫–Ω–æ–ø–∫–∞ "–ü—Ä–æ—Ñ–∏–ª—å" –≤ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
4. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —è–∑—ã–∫–∞
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ:
   - URL –∏–∑–º–µ–Ω–∏–ª—Å—è (–¥–æ–±–∞–≤–∏–ª—Å—è `/ru` –∏–ª–∏ `/en`)
   - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–µ—Ä–µ–≤–µ–¥–µ–Ω
   - –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —è–∑—ã–∫ —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è

### 2. Playwright —Ç–µ—Å—Ç—ã

```bash
npx playwright test tests/locale-and-layout.spec.ts --headed
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ë–î

```sql
SELECT id, first_name, last_name, preferred_locale 
FROM user_profiles 
WHERE email IN (
  SELECT email FROM auth.users WHERE email = 'filippmiller@gmail.com'
);
```

---

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞

### –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

1. User –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ —Å–∞–π—Ç —Å Accept-Language: `en-US,en;q=0.9`
2. Supabase —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å –≤ `auth.users`
3. Trigger `create_user_profile()` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
4. –ü–∞—Ä—Å–∏—Ç—Å—è `Accept-Language` ‚Üí –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è `en`
5. –°–æ–∑–¥–∞–µ—Ç—Å—è `user_profiles` —Å `preferred_locale = 'en'`
6. User –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∏–¥–∏—Ç –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —è–∑—ã–∫–∞:

1. User –∫–ª–∏–∫–∞–µ—Ç –Ω–∞ –∫–Ω–æ–ø–∫—É "EN" –∏–ª–∏ "RU"
2. LanguageSwitcher –≤—ã–∑—ã–≤–∞–µ—Ç `POST /api/user/locale`
3. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è `user_profiles.preferred_locale`
4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è cookie `NEXT_LOCALE`
5. Redirect –Ω–∞ `/en/...` –∏–ª–∏ `/ru/...`
6. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –≤–∏–∑–∏—Ç–µ —è–∑—ã–∫ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ –ë–î

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —è–∑—ã–∫–∞:

```
1. URL –ø–∞—Ä–∞–º–µ—Ç—Ä (/ru/dashboard)
   ‚Üì
2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (user_profiles.preferred_locale)
   ‚Üì
3. Cookie (NEXT_LOCALE)
   ‚Üì
4. Accept-Language header
   ‚Üì
5. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 'ru'
```

---

## üìÅ –§–∞–π–ª—ã –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã/—Å–æ–∑–¥–∞–Ω—ã

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- `src/i18n/routing.ts` - routing config
- `src/app/api/user/locale/route.ts` - API endpoint
- `src/lib/locale-detection.ts` - —É—Ç–∏–ª–∏—Ç—ã
- `docs/LOCALIZATION.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `tests/locale-and-layout.spec.ts` - —Ç–µ—Å—Ç—ã
- `supabase/migrations/0025_add_preferred_locale.sql` - –º–∏–≥—Ä–∞—Ü–∏—è
- `apply-locale-migration.sql` - SQL –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

### –ò–∑–º–µ–Ω–µ–Ω—ã:
- `src/proxy.ts` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç routing config
- `src/i18n/request.ts` - —á–∏—Ç–∞–µ—Ç –∏–∑ –ë–î
- `src/components/LanguageSwitcher.tsx` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î
- `src/app/[locale]/(protected)/layout.tsx` - —É–±—Ä–∞–Ω –¥—É–±–ª–∏–∫–∞—Ç
- `src/app/[locale]/(protected)/app/page.tsx` - full-width
- `src/components/Nav.tsx` - –¥–æ–±–∞–≤–ª–µ–Ω Profile
- `src/messages/ru/common.json` - –¥–æ–±–∞–≤–ª–µ–Ω –ø–µ—Ä–µ–≤–æ–¥ "–ü—Ä–æ—Ñ–∏–ª—å"
- `src/messages/en/common.json` - –¥–æ–±–∞–≤–ª–µ–Ω "Profile"

---

## üîç –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: –Ø–∑—ã–∫ –Ω–µ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
console.log('Current locale:', document.documentElement.lang);
console.log('Cookie:', document.cookie);

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API
fetch('/api/user/locale').then(r => r.json()).then(console.log);
```

### –ü—Ä–æ–±–ª–µ–º–∞: –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–Ω–≥–ª–∏–π—Å–∫–∏–π

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ë–î:
```sql
SELECT preferred_locale FROM user_profiles WHERE id = auth.uid();
```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cookie (–≤ DevTools ‚Üí Application ‚Üí Cookies):
   - –£–¥–∞–ª–∏—Ç–µ `NEXT_LOCALE`
   - –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É

3. –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à Next.js:
```bash
rm -rf .next
npm run dev
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `docs/LOCALIZATION.md`

GeoIP (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ IP –¥–ª—è –µ—â–µ –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —è–∑—ã–∫–∞.
